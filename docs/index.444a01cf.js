var t=class{UNIC_CLASS="";CONTAINER="";BOX="";MODAL="";MODAL_CONTENT="";WIDGET=null;static Instance=null;constructor({container:t,box:e,modal:n,modalContent:s}){this.CONTAINER=t,this.BOX=e,this.MODAL=n,this.MODAL_CONTENT=s,this.bindEvent()}bindEvent(){document.addEventListener("click",(t=>{const e=t.target.closest(".widget__remove-button");if(e){const t=e.closest(".widget");this.close(t)}})),document.addEventListener("dragstart",(t=>{const e=t.target.closest(".widget");e&&(e.closest(this.BOX).classList.add("original-box"),e.classList.add("draggable"))})),document.addEventListener("dragend",(t=>{const e=t.target.closest(".widget");e&&e.classList.remove("draggable")})),document.addEventListener("dragover",(t=>{t.preventDefault();const e=t.target.closest(this.BOX);if(!e){const t=document.querySelector(this.CONTAINER).querySelector(".dragover");return void(t&&t.classList.remove("dragover"))}const n=document.querySelector(".dragover");n&&n!==e&&n.classList.remove("dragover"),e.classList.add("dragover")})),document.addEventListener("drop",(t=>{t.preventDefault();const e=t.target.closest(this.BOX);if(!e)return;const n=document.querySelector(".draggable"),s=e.querySelector(".widget"),a=document.querySelector(this.CONTAINER).querySelector(".original-box");s&&a.append(s),a.classList.remove("original-box");const i=document.querySelector(".dragover");i&&i.classList.remove("dragover"),e.append(n)}))}createWidget(){const t=document.createElement("div");t.classList.add("widget",this.UNIC_CLASS),t.setAttribute("draggable",!0);const e=this.render();if(e&&this.CONTAINER){let n;t.insertAdjacentHTML("beforeend",e),t.insertAdjacentHTML("afterbegin",this.renderButton()),this.WIDGET=t;const s=document.querySelector(this.CONTAINER).querySelectorAll(this.BOX);for(let t=0;t<s.length;t++){const e=s[t];if(!e.querySelector(".widget")){n=e;break}}n.append(t)}}close=t=>{t.remove()};render=()=>!1;renderButton=()=>'\n\t\t<button class="w-control widget__remove-button">\n\t\t\t&times;\n\t\t</button>\n\t'};class e extends t{static Instance=null;UNIC_CLASS="widget-time";HOUR="00";MINUTE="00";SECONDS="00";constructor(t){return e.Instance||(super(t),this.updateTime(),e.Instance=this),e.Instance}updateTime(){const t=new Date,[e,n,s]=t.toLocaleTimeString().split(":"),a=t.getMilliseconds();this.HOUR=e,this.MINUTE=n,this.SECONDS=s;[...document.querySelector(this.CONTAINER).querySelectorAll(`.${this.UNIC_CLASS}`)].forEach((t=>{t.querySelector(".hour").innerText=this.HOUR,t.querySelector(".minute").innerText=this.MINUTE,t.querySelector(".seconds").innerText=this.SECONDS})),setTimeout((()=>requestAnimationFrame((()=>this.updateTime()))),1e3-a)}createWidget(){super.createWidget()}render=()=>`\n\t\t<p>\n\t\t\t<span class="hour">${this.HOUR}</span>\n\t\t\t:\n\t\t\t<span class="minute">${this.MINUTE}</span>\n\t\t\t:\n\t\t\t<span class="seconds">${this.SECONDS}</span>\n\t\t</p>\n\t`}var n=e;var s=class extends t{UNIC_CLASS="widget-image";API="xWrdYakL5fidHlmgDdoilw==m4GHFehrDiaJz3k5";CATEGORY="nature";WIDGET;addListenerOnDinamicElement(){this.WIDGET.addEventListener("click",(t=>{const e=t.target.closest("button");if(!e)return;switch(e.getAttribute("role")){case"update":this.getData();break;case"config":this.openFormChabgeCategory()}}))}createWidget(){super.createWidget(),this.getData(),this.addListenerOnDinamicElement()}getData=()=>{const t=this.WIDGET.querySelector("img");this.changeDisabledButton(!0),t.style.display="none",fetch(`https://api.api-ninjas.com/v1/randomimage?category=${this.CATEGORY}`,{headers:{"X-Api-Key":this.API,Accept:"image/jpg"}}).then((t=>t.blob())).then((e=>{const n=URL.createObjectURL(e);t.src=n,t.style.display="block",this.changeDisabledButton(!1)})).catch((t=>{this.changeDisabledButton(!1)}))};openFormChabgeCategory=()=>{const t=document.querySelector("#w-modal"),e=new Event("show");t.dispatchEvent(e);const n=document.createElement("form");n.addEventListener("submit",this.changeCategory);const s=`\n\t\t\t\t<select name="category">\n\t\t\t\t\t${["nature","city","technology","food","still_life","abstract","wildlife"].map((t=>`\n\t\t\t\t\t<option ${t===this.CATEGORY}>\n\t\t\t\t\t\t${t}\n\t\t\t\t\t</option />`))}\n\t\t\t\t</select>\n\t\t\t\t<button>Сохранить</button>\n\t\t`;n.innerHTML=s,t.querySelector("#w-modal__content").append(n)};changeDisabledButton=t=>{[...this.WIDGET.querySelectorAll("button")].forEach((e=>e.disabled=t))};changeCategory=t=>{t.preventDefault();const e=new FormData(t.target);this.CATEGORY=e.get("category")||this.CATEGORY;document.querySelector("#w-modal").dispatchEvent(new Event("hide")),this.getData()};render=()=>`\n\t\t<button class="w-control widget__update-button" role="update">\n\t\t\t&#10227;\n\t\t</button>\n\n\t\t<button class="w-control widget__config-button" role="config">\n\t\t\t&#9881;\n\t\t</button>\n\n    <div class="widget-image__container">\n\t\t\t<div class="widget-image__preloader"></div>\n      <img class="widget-image__img" alt=${this.CATEGORY}>\n    </div>\n  `};class a extends t{UNIC_CLASS="widget-valute";VALUTES=null;static Instance=null;constructor(t){return a.Instance||(super(t),a.Instance=this),a.Instance}createWidget(){super.createWidget(),this.VALUTES||this.update()}update=()=>{fetch("https://www.cbr-xml-daily.ru/daily_json.js").then((t=>t.json())).then((t=>{this.VALUTES=t;const{usd:e,diffUsd:n,eur:s,diffEur:a,lastUpdate:i}=this.getData();[...document.querySelector(this.CONTAINER).querySelectorAll(`.${this.UNIC_CLASS}`)].forEach((t=>{const r=t.querySelector(".USD");r.classList.remove("growth","fall"),r.classList.add(n),r.querySelector("span.value").innerText=e;const o=t.querySelector(".EUR");o.classList.remove("growth","fall"),o.classList.add(a),o.querySelector("span.value").innerText=s,t.querySelector(".last_update").innerText=i}))}))};getData=()=>{const t=this.VALUTES?.Valute?.USD?.Value||0,e=t-(this.VALUTES?.Valute?.USD?.Previous||0)>0?"growth":"fall",n=this.VALUTES?.Valute?.EUR?.Value||0;return{usd:t,diffUsd:e,eur:n,diffEur:(n-this.VALUTES?.Valute?.EUR?.Previous||0)>0?"growth":"fall",lastUpdate:this.VALUTES?.Timestamp?new Date(this.VALUTES.Timestamp).toLocaleDateString():"Нет данных"}};render=()=>{const{usd:t,diffUsd:e,eur:n,diffEur:s,lastUpdate:a}=this.getData();return`\n    <div>\n      <div class="info USD ${e}">\n        <span class="valute">&#36</span>\n        <p class="stats">\n          <span class="value">\n          ${t}\n          </span>\n           руб.\n        </p>\n      </div>\n\n      <div class="info EUR ${s}">\n        <span class="valute">&#8364;</span>\n        <p class="stats">\n          <span class="value">\n            ${n}\n          </span>\n           руб.\n        </p>\n      </div>\n    </div>\n\n    <p class="last_update">\n      ${a}\n    </p>\n  \n      `}}var i=a;new class{CONTAINER="";MODAL="#w-modal";MODAL_CONTENT="#w-modal__content";ROW=3;COLUMNS=0;WIDGETS=[{widget:"time",module:n,title:"Добавить виджет времени"},{widget:"valute",module:i,title:"Добавить виджет валют"},{widget:"image",module:s,title:"Добавить виджет изображения"}];constructor({container:t="#widgets-wrapper",columns:e=3}){this.CONTAINER=t,this.COLUMNS=e,this.renderContainer(),this.bindEvents()}renderContainer=()=>{const t=document.createElement("div");t.classList.add("w-container");const e=document.createElement("div");e.classList.add("w-cell"),e.setAttribute("dropzone",!0);for(let n=0;n<this.ROW*this.COLUMNS;n++)t.append(e.cloneNode());const n=document.createElement("div");n.id="w-modal";const s=document.createElement("div");s.id="w-modal__backdrop";const a=document.createElement("div");a.id="w-modal__content",n.append(s),n.append(a);const i=document.createElement("button");i.setAttribute("id","add-widget"),i.setAttribute("title","add widget"),i.setAttribute("role","open-modal-with-widgets"),i.innerHTML="&plus;";const r=document.querySelector(this.CONTAINER);r.append(t),r.append(i),r.append(n)};bindEvents=()=>{const t=document.querySelector(this.CONTAINER),e=t.querySelector(this.MODAL);e.addEventListener("show",(t=>t.target.style.display="flex")),e.addEventListener("hide",(t=>{const e=t.target;e.style.display="";e.querySelector(this.MODAL_CONTENT).innerHTML=""}));const n=t.querySelector("#w-modal__backdrop"),s=new Event("hide");n.addEventListener("click",(()=>e.dispatchEvent(s))),t.addEventListener("click",(t=>{const e=t.target.closest("button");if(!e)return;switch(e.getAttribute("role")){case"open-modal-with-widgets":this.openModalWithWidgets();break;case"add-widget":this.addWidget(e)}}))};openModalWithWidgets=()=>{const t=document.querySelector(this.CONTAINER).querySelector(this.MODAL),e=t.querySelector(this.MODAL_CONTENT);this.WIDGETS.map((t=>this.appendButton(t,e))),t.dispatchEvent(new Event("show"))};appendButton=({widget:t,title:e},n)=>{const s=document.createElement("button");s.innerText=e,s.setAttribute("role","add-widget"),s.dataset.widget=t,n.append(s)};addWidget=t=>{const e=t.dataset.widget||"",n=this.WIDGETS.find((t=>t.widget===e));if(n){new(0,n.module)({container:this.CONTAINER,box:".w-cell",modal:this.MODAL,modalContent:this.MODAL_CONTENT}).createWidget()}const s=document.querySelector(this.CONTAINER).querySelector(this.MODAL),a=new Event("hide");s.dispatchEvent(a)}}({columns:4});
//# sourceMappingURL=index.444a01cf.js.map
